# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EXPO BUILD & CHECK - GitHub Action
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Este workflow se ejecuta automÃ¡ticamente cuando el CTO hace cambios
# Verifica que la app compile correctamente con Expo SDK 54

name: Expo Build Check

on:
  workflow_dispatch:  # Permite ejecutar manualmente (desde n8n)
  push:
    branches: [main]
    paths:
      - 'app/**'
      - 'components/**'
      - 'constants/**'
      - 'hooks/**'
      - 'package.json'
      - 'app.json'
      - 'tsconfig.json'

jobs:
  build-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ“¦ Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: ğŸ“š Instalar dependencias
        run: npm ci || npm install
      
      - name: ğŸ” Verificar TypeScript
        run: npx tsc --noEmit
        continue-on-error: false
      
      - name: ğŸ§¹ Lint Check
        run: npm run lint || echo "No lint script"
        continue-on-error: true
      
      - name: ğŸ—ï¸ Expo Export (Web)
        run: npx expo export --platform web
        continue-on-error: false
      
      - name: âœ… Build exitoso
        if: success()
        run: echo "âœ… La app compila correctamente con Expo SDK 54"
      
      - name: âŒ Build fallido
        if: failure()
        run: |
          echo "âŒ Error de compilaciÃ³n detectado"
          echo "Revisa los logs anteriores para ver el error"
          exit 1

  # Job opcional para publicar en Expo (si tienes cuenta)
  # publish-expo:
  #   needs: build-check
  #   runs-on: ubuntu-latest
  #   if: github.event_name == 'push'
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - uses: actions/setup-node@v4
  #       with:
  #         node-version: '20'
  #         cache: 'npm'
  #     
  #     - run: npm ci
  #     
  #     - name: Setup Expo
  #       uses: expo/expo-github-action@v8
  #       with:
  #         expo-version: latest
  #         token: ${{ secrets.EXPO_TOKEN }}
  #     
  #     - name: Publish to Expo
  #       run: expo publish --non-interactive
